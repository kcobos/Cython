<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Cython by kcobos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Cython</h1>
      <h2 class="project-tagline">Comparativa de Cython y primeros pasos</h2>
      <a href="https://github.com/kcobos/Cython" class="btn">View on GitHub</a>
      <a href="https://github.com/kcobos/Cython/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/kcobos/Cython/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="cython" class="anchor" href="#cython" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cython</h1>

<h2>
<a id="qué-es-cython" class="anchor" href="#qu%C3%A9-es-cython" aria-hidden="true"><span class="octicon octicon-link"></span></a>¿Qué es Cython?</h2>

<p>Es un compilador basado en Pyrex.</p>

<p>Permite crear funciones en Python y compilarlas en lenguaje objeto.</p>

<p>También permite hacer llamadas a funciones de C/C++.</p>

<h2>
<a id="qué-ventajas-tiene" class="anchor" href="#qu%C3%A9-ventajas-tiene" aria-hidden="true"><span class="octicon octicon-link"></span></a>¿Qué ventajas tiene?</h2>

<p>Al compilar en lenguaje objeto funciones, éstas no se tienen que interpretar para ejecutarse por lo que ganamos velocidad en la ejecución de un programa.</p>

<p>También podemos encapsular una aplicación hecha en C/C++ para, por ejemplo, desde Python hacerle una interfaz o pasarle datos obtenidos desde internet.</p>

<h2>
<a id="instalación" class="anchor" href="#instalaci%C3%B3n" aria-hidden="true"><span class="octicon octicon-link"></span></a>Instalación</h2>

<h3>
<a id="linux" class="anchor" href="#linux" aria-hidden="true"><span class="octicon octicon-link"></span></a>Linux:</h3>

<pre><code>sudo apt-get install cython libpython2.7-dev # Para Python2
sudo apt-get install cython3 libpython3.4-dev # Para Python3
</code></pre>

<h3>
<a id="windows" class="anchor" href="#windows" aria-hidden="true"><span class="octicon octicon-link"></span></a>Windows:</h3>

<pre><code>Existen múltiples opciones 
    https://github.com/cython/cython/wiki/InstallingOnWindows
</code></pre>

<h2>
<a id="un-ejemplo-simple" class="anchor" href="#un-ejemplo-simple" aria-hidden="true"><span class="octicon octicon-link"></span></a>Un ejemplo simple</h2>

<p>Para empezar vamos a hacer un ejemplo simple como puede ser la sucesión de Fibonacci de forma recursiva.
Vamos a crear una función de Fibonacci de tres maneras diferentes:</p>

<ul>
<li>En Python normal</li>
<li>En Cython (Python compilado)</li>
<li>En C/C++
Por último vamos a hacer una comparación de tiempos entre las distintas funciones.</li>
</ul>

<h3>
<a id="creación-de-ficheros" class="anchor" href="#creaci%C3%B3n-de-ficheros" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creación de ficheros</h3>

<h4>
<a id="fibonaccipythonpy-python-normal" class="anchor" href="#fibonaccipythonpy-python-normal" aria-hidden="true"><span class="octicon octicon-link"></span></a>fibonacciPython.py (Python normal)</h4>

<pre><code>def fibonacciRec(n):
    if n==0:
        return 0
    elif n==1:
        return 1
    else:
        return fibonacciRec(n-2) + fibonacciRec(n-1)
</code></pre>

<h4>
<a id="fibonaccicythonpyx-cython" class="anchor" href="#fibonaccicythonpyx-cython" aria-hidden="true"><span class="octicon octicon-link"></span></a>fibonacciCython.pyx (Cython)</h4>

<pre><code>def fibonacciRec(n):
    if n==0:
        return 0
    elif n==1:
        return 1
    else:
        return fibonacciRec(n-2) + fibonacciRec(n-1)
</code></pre>

<h4>
<a id="fibonaccicpp-cc" class="anchor" href="#fibonaccicpp-cc" aria-hidden="true"><span class="octicon octicon-link"></span></a>fibonacci.cpp (C/C++)</h4>

<div class="highlight highlight-source-c++"><pre>    <span class="pl-k">int</span> <span class="pl-en">fibonacciRec</span>(<span class="pl-k">int</span> n){
        <span class="pl-k">if</span> (n==<span class="pl-c1">0</span>)
            <span class="pl-k">return</span> <span class="pl-c1">0</span>;
        <span class="pl-k">else</span> <span class="pl-k">if</span> (n==<span class="pl-c1">1</span>)
            <span class="pl-k">return</span> <span class="pl-c1">1</span>;
        <span class="pl-k">else</span>
            <span class="pl-k">return</span> <span class="pl-c1">fibonacciRec</span>(n-<span class="pl-c1">2</span>) + <span class="pl-c1">fibonacciRec</span>(n-<span class="pl-c1">1</span>);
    }

    <span class="pl-k">extern</span> <span class="pl-s"><span class="pl-pds">"</span>C<span class="pl-pds">"</span></span> {
        <span class="pl-k">int</span> <span class="pl-en">fibonacciRecC</span>(<span class="pl-k">int</span> n){<span class="pl-k">return</span> <span class="pl-c1">fibonacciRec</span>(n);}
    }</pre></div>

<h2>
<a id="aclaraciones" class="anchor" href="#aclaraciones" aria-hidden="true"><span class="octicon octicon-link"></span></a>Aclaraciones</h2>

<p>Cython tiene la misma sintaxis que Python aunque cosas nuevas. </p>

<p>Cuidado con la extensión de los archivos!!</p>

<p>En C/C++, hay que especificar las funciones o las variables que tiene una vinculación externa, es decir, aquellas que queramos llamar desde Python.</p>

<p>Para ello usamos el bloque “extern” donde dentro declaramos variables y funciones que se van a poder usar desde Python.</p>

<h2>
<a id="compilación-de-cython" class="anchor" href="#compilaci%C3%B3n-de-cython" aria-hidden="true"><span class="octicon octicon-link"></span></a>Compilación de Cython</h2>

<p>Una vez que tenemos los ficheros pyx (Cython) tenemos que generar su código objeto.</p>

<p>Para ello necesitamos hacer uso de un script de configuración que lo que va a hacer es buscar todos los archivos con extensión pyx y va a generar su código objeto, un archivo con extensión so.</p>

<h4>
<a id="lo-único-que-tenemos-que-hacer-es-llamar-a-dicho-script-de-la-siguiente-manera" class="anchor" href="#lo-%C3%BAnico-que-tenemos-que-hacer-es-llamar-a-dicho-script-de-la-siguiente-manera" aria-hidden="true"><span class="octicon octicon-link"></span></a>Lo único que tenemos que hacer es llamar a dicho script de la siguiente manera:</h4>

<pre><code>python setup.py build_ext --inplace #Python2
python3 setup.py build_ext --inplace #Python3
</code></pre>

<h3>
<a id="script-de-configuración" class="anchor" href="#script-de-configuraci%C3%B3n" aria-hidden="true"><span class="octicon octicon-link"></span></a>Script de configuración</h3>

<pre><code>from distutils.core import setup
from Cython.Build import cythonize
import glob, os
files = []
os.chdir(".")

for file in glob.glob("*.pyx"):
    files.append(file)

setup(
    ext_modules = cythonize(files)
)
</code></pre>

<h2>
<a id="uso-de-cython" class="anchor" href="#uso-de-cython" aria-hidden="true"><span class="octicon octicon-link"></span></a>Uso de Cython</h2>

<p>Una vez generado el código objeto, hacer uso de las funciones que haya en el fichero .pyx</p>

<h4>
<a id="para-ello-necesitamos-importar-el-módulo-y-ya-podemos-usarlas" class="anchor" href="#para-ello-necesitamos-importar-el-m%C3%B3dulo-y-ya-podemos-usarlas" aria-hidden="true"><span class="octicon octicon-link"></span></a>Para ello necesitamos importar el módulo y ya podemos usarlas:</h4>

<pre><code>import fibonacciCython #importa el archivo “fibonacciCython.so”
print(fibonacciCython.fibonacciRec(5)) #se hace uso de la función fibonacciRec
</code></pre>

<h3>
<a id="compilación-de-cc-para-el-uso-con-python" class="anchor" href="#compilaci%C3%B3n-de-cc-para-el-uso-con-python" aria-hidden="true"><span class="octicon octicon-link"></span></a>Compilación de C/C++ para el uso con Python</h3>

<h4>
<a id="una-vez-creado-el-archivo-cc-con-las-funciones-que-se-quieran-usar-en-python-especificadas-para-que-se-vinculen-externamente-podemos-proceder-a-compilarlo" class="anchor" href="#una-vez-creado-el-archivo-cc-con-las-funciones-que-se-quieran-usar-en-python-especificadas-para-que-se-vinculen-externamente-podemos-proceder-a-compilarlo" aria-hidden="true"><span class="octicon octicon-link"></span></a>Una vez creado el archivo C/C++ con las funciones que se quieran usar en Python especificadas para que se vinculen externamente, podemos proceder a compilarlo:</h4>

<pre><code>g++ -c -fPIC fibonacci.cpp -o fibonacci.o
g++ -shared -Wl,-soname,libfibonacci.so -o libfibonacci.so  fibonacci.o
</code></pre>

<p>Con esto hemos creado el archivo .so necesario para trabajar en Python.</p>

<h3>
<a id="uso-de-cc-en-python" class="anchor" href="#uso-de-cc-en-python" aria-hidden="true"><span class="octicon octicon-link"></span></a>Uso de C/C++ en Python</h3>

<h4>
<a id="una-vez-generado-el-archivo-so-en-nuestro-caso-libfibonacciso-podemos-usar-las-funciones-externalizadas-de-la-siguiente-manera" class="anchor" href="#una-vez-generado-el-archivo-so-en-nuestro-caso-libfibonacciso-podemos-usar-las-funciones-externalizadas-de-la-siguiente-manera" aria-hidden="true"><span class="octicon octicon-link"></span></a>Una vez generado el archivo .so, en nuestro caso libfibonacci.so, podemos usar las funciones externalizadas de la siguiente manera:</h4>

<pre><code>from ctypes import cdll #importamos cdll para cargar bibliotecas de C/C++
libfi = cdll.LoadLibrary('./libfibonacci.so') #cargamos la biblioteca en libfi
print(libfi.fibonacciRecC(5)) #usamos las funciones de dicha biblioteca
</code></pre>

<h2>
<a id="comparativa-de-funciones" class="anchor" href="#comparativa-de-funciones" aria-hidden="true"><span class="octicon octicon-link"></span></a>Comparativa de funciones</h2>

<h4>
<a id="para-saber-si-cython-realmente-merece-la-pena-hemos-comparado-los-tiempos-de-ejecución-para-distintos-tamaños-de-n" class="anchor" href="#para-saber-si-cython-realmente-merece-la-pena-hemos-comparado-los-tiempos-de-ejecuci%C3%B3n-para-distintos-tama%C3%B1os-de-n" aria-hidden="true"><span class="octicon octicon-link"></span></a>Para saber si Cython realmente merece la pena, hemos comparado los tiempos de ejecución para distintos tamaños de n:</h4>

<pre><code>| N  | Python   | Cython   | C/C++   |
|----|----------|----------|---------|
| 39 | 29.1104  | 18.1274  | 0.8510  |
| 40 | 47.2322  | 29.4395  | 1.4826  |
| 41 | 76.4090  | 47.3236  | 2.4527  |
| 42 | 123.7818 | 75.5095  | 3.8937  |
| 43 | 202.2534 | 123.7621 | 6.1991  |
| 44 | 327.2314 | 199.7456 | 9.9453  |
| 45 | 529.8116 | 364.6818 | 15.9019 |
</code></pre>

<p><img src="https://github.com/kcobos/Cython/blob/master/comparativa.png" alt="Gráfico"></p>

<h2>
<a id="para-terminar" class="anchor" href="#para-terminar" aria-hidden="true"><span class="octicon octicon-link"></span></a>Para terminar</h2>

<p>Desde Cython se puede hacer llamadas a funciones de C/C++:</p>

<h4>
<a id="cythoncpyx" class="anchor" href="#cythoncpyx" aria-hidden="true"><span class="octicon octicon-link"></span></a>cythonC.pyx</h4>

<pre><code>from libc.stdlib cimport atoi
cdef parse_charptr_to_py_int(char* s):
    assert s is not NULL, "string is NULL"
    return atoi(s)
def string_to_int(n):
    return parse_charptr_to_py_int(n)
</code></pre>

<p>Usándose de igual manera que un .pyx normal.</p>

<h2>
<a id="enlaces-de-interés" class="anchor" href="#enlaces-de-inter%C3%A9s" aria-hidden="true"><span class="octicon octicon-link"></span></a>Enlaces de interés</h2>

<ul>
<li><a href="http://docs.cython.org/src/tutorial/cython_tutorial.html">http://docs.cython.org/src/tutorial/cython_tutorial.html</a></li>
<li><a href="http://docs.cython.org/src/userguide/language_basics.html">http://docs.cython.org/src/userguide/language_basics.html</a></li>
<li><a href="http://docs.cython.org/src/userguide/wrapping_CPlusPlus.html">http://docs.cython.org/src/userguide/wrapping_CPlusPlus.html</a></li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/kcobos/Cython">Cython</a> is maintained by <a href="https://github.com/kcobos">kcobos</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
