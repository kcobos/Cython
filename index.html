<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Cython : Comparativa de Cython y primeros pasos">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Cython</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/kcobos/Cython">View on GitHub</a>

          <h1 id="project_title">Cython</h1>
          <h2 id="project_tagline">Comparativa de Cython y primeros pasos</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/kcobos/Cython/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/kcobos/Cython/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="cython" class="anchor" href="#cython" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cython</h1>

<h2>
<a id="qué-es-cython" class="anchor" href="#qu%C3%A9-es-cython" aria-hidden="true"><span class="octicon octicon-link"></span></a>¿Qué es Cython?</h2>

<p>Es un compilador basado en Pyrex.</p>

<p>Permite crear funciones en Python y compilarlas en lenguaje objeto.</p>

<p>También permite hacer llamadas a funciones de C/C++.</p>

<h2>
<a id="qué-ventajas-tiene" class="anchor" href="#qu%C3%A9-ventajas-tiene" aria-hidden="true"><span class="octicon octicon-link"></span></a>¿Qué ventajas tiene?</h2>

<p>Al compilar en lenguaje objeto funciones, éstas no se tienen que interpretar para ejecutarse por lo que ganamos velocidad en la ejecución de un programa.</p>

<p>También podemos encapsular una aplicación hecha en C/C++ para, por ejemplo, desde Python hacerle una interfaz o pasarle datos obtenidos desde internet.</p>

<h2>
<a id="instalación" class="anchor" href="#instalaci%C3%B3n" aria-hidden="true"><span class="octicon octicon-link"></span></a>Instalación</h2>

<h3>
<a id="linux" class="anchor" href="#linux" aria-hidden="true"><span class="octicon octicon-link"></span></a>Linux:</h3>

<pre><code>sudo apt-get install cython libpython2.7-dev # Para Python2
sudo apt-get install cython3 libpython3.4-dev # Para Python3
</code></pre>

<h3>
<a id="windows" class="anchor" href="#windows" aria-hidden="true"><span class="octicon octicon-link"></span></a>Windows:</h3>

<pre><code>Existen múltiples opciones 
    https://github.com/cython/cython/wiki/InstallingOnWindows
</code></pre>

<h2>
<a id="un-ejemplo-simple" class="anchor" href="#un-ejemplo-simple" aria-hidden="true"><span class="octicon octicon-link"></span></a>Un ejemplo simple</h2>

<p>Para empezar vamos a hacer un ejemplo simple como puede ser la sucesión de Fibonacci de forma recursiva.
Vamos a crear una función de Fibonacci de tres maneras diferentes:</p>

<ul>
<li>En Python normal</li>
<li>En Cython (Python compilado)</li>
<li>En C/C++
Por último vamos a hacer una comparación de tiempos entre las distintas funciones.</li>
</ul>

<h3>
<a id="creación-de-ficheros" class="anchor" href="#creaci%C3%B3n-de-ficheros" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creación de ficheros</h3>

<h4>
<a id="fibonaccipythonpy-python-normal" class="anchor" href="#fibonaccipythonpy-python-normal" aria-hidden="true"><span class="octicon octicon-link"></span></a>fibonacciPython.py (Python normal)</h4>

<div class="highlight highlight-source-python"><pre>    <span class="pl-k">def</span> <span class="pl-en">fibonacciRec</span>(<span class="pl-smi">n</span>):
        <span class="pl-k">if</span> n<span class="pl-k">==</span><span class="pl-c1">0</span>:
            <span class="pl-k">return</span> <span class="pl-c1">0</span>
        <span class="pl-k">elif</span> n<span class="pl-k">==</span><span class="pl-c1">1</span>:
            <span class="pl-k">return</span> <span class="pl-c1">1</span>
        <span class="pl-k">else</span>:
            <span class="pl-k">return</span> fibonacciRec(n<span class="pl-k">-</span><span class="pl-c1">2</span>) <span class="pl-k">+</span> fibonacciRec(n<span class="pl-k">-</span><span class="pl-c1">1</span>)</pre></div>

<h4>
<a id="fibonaccicythonpyx-cython" class="anchor" href="#fibonaccicythonpyx-cython" aria-hidden="true"><span class="octicon octicon-link"></span></a>fibonacciCython.pyx (Cython)</h4>

<div class="highlight highlight-source-python"><pre>    <span class="pl-k">def</span> <span class="pl-en">fibonacciRec</span>(<span class="pl-smi">n</span>):
        <span class="pl-k">if</span> n<span class="pl-k">==</span><span class="pl-c1">0</span>:
            <span class="pl-k">return</span> <span class="pl-c1">0</span>
        <span class="pl-k">elif</span> n<span class="pl-k">==</span><span class="pl-c1">1</span>:
            <span class="pl-k">return</span> <span class="pl-c1">1</span>
        <span class="pl-k">else</span>:
            <span class="pl-k">return</span> fibonacciRec(n<span class="pl-k">-</span><span class="pl-c1">2</span>) <span class="pl-k">+</span> fibonacciRec(n<span class="pl-k">-</span><span class="pl-c1">1</span>)</pre></div>

<h4>
<a id="fibonaccicpp-cc" class="anchor" href="#fibonaccicpp-cc" aria-hidden="true"><span class="octicon octicon-link"></span></a>fibonacci.cpp (C/C++)</h4>

<div class="highlight highlight-source-c++"><pre>    <span class="pl-k">int</span> <span class="pl-en">fibonacciRec</span>(<span class="pl-k">int</span> n){
        <span class="pl-k">if</span> (n==<span class="pl-c1">0</span>)
            <span class="pl-k">return</span> <span class="pl-c1">0</span>;
        <span class="pl-k">else</span> <span class="pl-k">if</span> (n==<span class="pl-c1">1</span>)
            <span class="pl-k">return</span> <span class="pl-c1">1</span>;
        <span class="pl-k">else</span>
            <span class="pl-k">return</span> <span class="pl-c1">fibonacciRec</span>(n-<span class="pl-c1">2</span>) + <span class="pl-c1">fibonacciRec</span>(n-<span class="pl-c1">1</span>);
    }

    <span class="pl-k">extern</span> <span class="pl-s"><span class="pl-pds">"</span>C<span class="pl-pds">"</span></span> {
        <span class="pl-k">int</span> <span class="pl-en">fibonacciRecC</span>(<span class="pl-k">int</span> n){<span class="pl-k">return</span> <span class="pl-c1">fibonacciRec</span>(n);}
    }</pre></div>

<h2>
<a id="aclaraciones" class="anchor" href="#aclaraciones" aria-hidden="true"><span class="octicon octicon-link"></span></a>Aclaraciones</h2>

<p>Cython tiene la misma sintaxis que Python aunque cosas nuevas. </p>

<p>Cuidado con la extensión de los archivos!!</p>

<p>En C/C++, hay que especificar las funciones o las variables que tiene una vinculación externa, es decir, aquellas que queramos llamar desde Python.</p>

<p>Para ello usamos el bloque “extern” donde dentro declaramos variables y funciones que se van a poder usar desde Python.</p>

<h2>
<a id="compilación-de-cython" class="anchor" href="#compilaci%C3%B3n-de-cython" aria-hidden="true"><span class="octicon octicon-link"></span></a>Compilación de Cython</h2>

<p>Una vez que tenemos los ficheros pyx (Cython) tenemos que generar su código objeto.</p>

<p>Para ello necesitamos hacer uso de un script de configuración que lo que va a hacer es buscar todos los archivos con extensión pyx y va a generar su código objeto, un archivo con extensión so.</p>

<h4>
<a id="lo-único-que-tenemos-que-hacer-es-llamar-a-dicho-script-de-la-siguiente-manera" class="anchor" href="#lo-%C3%BAnico-que-tenemos-que-hacer-es-llamar-a-dicho-script-de-la-siguiente-manera" aria-hidden="true"><span class="octicon octicon-link"></span></a>Lo único que tenemos que hacer es llamar a dicho script de la siguiente manera:</h4>

<pre><code>python setup.py build_ext --inplace #Python2
python3 setup.py build_ext --inplace #Python3
</code></pre>

<h3>
<a id="script-de-configuración" class="anchor" href="#script-de-configuraci%C3%B3n" aria-hidden="true"><span class="octicon octicon-link"></span></a>Script de configuración</h3>

<div class="highlight highlight-source-python"><pre>    <span class="pl-k">from</span> distutils.core <span class="pl-k">import</span> setup
    <span class="pl-k">from</span> Cython.Build <span class="pl-k">import</span> cythonize
    <span class="pl-k">import</span> glob, os
    files <span class="pl-k">=</span> []
    os.chdir(<span class="pl-s"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span>)

    <span class="pl-k">for</span> <span class="pl-c1">file</span> <span class="pl-k">in</span> glob.glob(<span class="pl-s"><span class="pl-pds">"</span>*.pyx<span class="pl-pds">"</span></span>):
        files.append(<span class="pl-c1">file</span>)

    setup(
        <span class="pl-smi">ext_modules</span> <span class="pl-k">=</span> cythonize(files)
    )</pre></div>

<h2>
<a id="uso-de-cython" class="anchor" href="#uso-de-cython" aria-hidden="true"><span class="octicon octicon-link"></span></a>Uso de Cython</h2>

<p>Una vez generado el código objeto, hacer uso de las funciones que haya en el fichero .pyx
Para ello necesitamos importar el módulo y ya podemos usarlas:</p>

<div class="highlight highlight-source-python"><pre>    <span class="pl-k">import</span> fibonacciCython <span class="pl-c">#importa el archivo “fibonacciCython.so”</span>
    <span class="pl-k">print</span>(fibonacciCython.fibonacciRec(<span class="pl-c1">5</span>)) <span class="pl-c">#se hace uso de la función fibonacciRec</span></pre></div>

<h3>
<a id="compilación-de-cc-para-el-uso-con-python" class="anchor" href="#compilaci%C3%B3n-de-cc-para-el-uso-con-python" aria-hidden="true"><span class="octicon octicon-link"></span></a>Compilación de C/C++ para el uso con Python</h3>

<p>Una vez creado el archivo C/C++ con las funciones que se quieran usar en Python especificadas para que se vinculen externamente, podemos proceder a compilarlo:</p>

<pre><code>    g++ -c -fPIC fibonacci.cpp -o fibonacci.o
    g++ -shared -Wl,-soname,libfibonacci.so -o libfibonacci.so  fibonacci.o
</code></pre>

<p>Con esto hemos creado el archivo .so necesario para trabajar en Python.</p>

<h3>
<a id="uso-de-cc-en-python" class="anchor" href="#uso-de-cc-en-python" aria-hidden="true"><span class="octicon octicon-link"></span></a>Uso de C/C++ en Python</h3>

<p>Una vez generado el archivo .so, en nuestro caso libfibonacci.so, podemos usar las funciones externalizadas de la siguiente manera:</p>

<div class="highlight highlight-source-python"><pre>    <span class="pl-k">from</span> ctypes <span class="pl-k">import</span> cdll <span class="pl-c">#importamos cdll para cargar bibliotecas de C/C++</span>
    libfi <span class="pl-k">=</span> cdll.LoadLibrary(<span class="pl-s"><span class="pl-pds">'</span>./libfibonacci.so<span class="pl-pds">'</span></span>) <span class="pl-c">#cargamos la biblioteca en libfi</span>
    <span class="pl-k">print</span>(libfi.fibonacciRecC(<span class="pl-c1">5</span>)) <span class="pl-c">#usamos las funciones de dicha biblioteca</span></pre></div>

<h2>
<a id="comparativa-de-funciones" class="anchor" href="#comparativa-de-funciones" aria-hidden="true"><span class="octicon octicon-link"></span></a>Comparativa de funciones</h2>

<p>Para saber si Cython realmente merece la pena, hemos comparado los tiempos de ejecución para distintos tamaños de n:</p>

<table>
<thead>
<tr>
<th>N</th>
<th>Python</th>
<th>Cython</th>
<th>C/C++</th>
</tr>
</thead>
<tbody>
<tr>
<td>39</td>
<td>29.1104</td>
<td>18.1274</td>
<td>0.8510</td>
</tr>
<tr>
<td>40</td>
<td>47.2322</td>
<td>29.4395</td>
<td>1.4826</td>
</tr>
<tr>
<td>41</td>
<td>76.4090</td>
<td>47.3236</td>
<td>2.4527</td>
</tr>
<tr>
<td>42</td>
<td>123.7818</td>
<td>75.5095</td>
<td>3.8937</td>
</tr>
<tr>
<td>43</td>
<td>202.2534</td>
<td>123.7621</td>
<td>6.1991</td>
</tr>
<tr>
<td>44</td>
<td>327.2314</td>
<td>199.7456</td>
<td>9.9453</td>
</tr>
<tr>
<td>45</td>
<td>529.8116</td>
<td>364.6818</td>
<td>15.9019</td>
</tr>
</tbody>
</table>

<p><img src="https://github.com/kcobos/Cython/raw/master/comparativa.png" alt="Gráfico"></p>

<h2>
<a id="para-terminar" class="anchor" href="#para-terminar" aria-hidden="true"><span class="octicon octicon-link"></span></a>Para terminar</h2>

<p>Desde Cython se puede hacer llamadas a funciones de C/C++:</p>

<h4>
<a id="cythoncpyx" class="anchor" href="#cythoncpyx" aria-hidden="true"><span class="octicon octicon-link"></span></a>cythonC.pyx</h4>

<div class="highlight highlight-source-python"><pre>    <span class="pl-k">from</span> libc.stdlib cimport atoi
    cdef parse_charptr_to_py_int(char<span class="pl-k">*</span> s):
        <span class="pl-k">assert</span> s <span class="pl-k">is</span> <span class="pl-k">not</span> NULL, <span class="pl-s"><span class="pl-pds">"</span>string is NULL<span class="pl-pds">"</span></span>
        <span class="pl-k">return</span> atoi(s)
    <span class="pl-k">def</span> <span class="pl-en">string_to_int</span>(<span class="pl-smi">n</span>):
        <span class="pl-k">return</span> parse_charptr_to_py_int(n)</pre></div>

<p>Usándose de igual manera que un .pyx normal.</p>

<h2>
<a id="enlaces-de-interés" class="anchor" href="#enlaces-de-inter%C3%A9s" aria-hidden="true"><span class="octicon octicon-link"></span></a>Enlaces de interés</h2>

<ul>
<li><a href="http://docs.cython.org/src/tutorial/cython_tutorial.html">http://docs.cython.org/src/tutorial/cython_tutorial.html</a></li>
<li><a href="http://docs.cython.org/src/userguide/language_basics.html">http://docs.cython.org/src/userguide/language_basics.html</a></li>
<li><a href="http://docs.cython.org/src/userguide/wrapping_CPlusPlus.html">http://docs.cython.org/src/userguide/wrapping_CPlusPlus.html</a></li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Cython maintained by <a href="https://github.com/kcobos">kcobos</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
